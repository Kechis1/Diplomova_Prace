nejpomalejsi:

DECLARE @SIRKETNO AS NVARCHAR(3)= '427',
@ALICIADRESLERINDEPARTMANI AS NVARCHAR(MAX) = 'MUHASEBEMUDURU',
@BILGIALICIADRESLERINDEPARTMANI AS NVARCHAR(MAX) = 'MUDUR',
@GIZLIALICIADRESLERINDEPARTMANI AS NVARCHAR(MAX) = 'FINANSKOORDINATORU'', ''FINANSSORUMLUSU'', ''DEVELOPER';
DECLARE @SQLQUERY AS NVARCHAR(MAX) = N ' BEGIN     DECLARE @KACGUNONCE INT= 13, @XML NVARCHAR(MAX), @KASABAKIYE NVARCHAR(MAX), @ALICIADRESLER VARCHAR(MAX), @BILGIALICIADRESLER VARCHAR(MAX), @GIZLIBILGIALICIADRESLER VARCHAR(MAX), @VUCUT NVARCHAR(MAX), @BASLIK VARCHAR(100)= '''', @CREATEDBY VARCHAR(100)= '''', @MESAJ VARCHAR(250)= '''', @ISYERINO SMALLINT;     DECLARE @MAD TABLE     (LOGICALREF              INT IDENTITY(1, 1),      ISYERINO                SMALLINT,      KASAKODU                VARCHAR(17),      KASAADI                 VARCHAR(51),      ALICIADRESLER           NVARCHAR(MAX),      BILGIALICIADRESLER      NVARCHAR(MAX),      GIZLIBILGIALICIADRESLER NVARCHAR(MAX)     ); END; --DEï¿½?I??KENLERI VE DEï¿½?I??KEN TABLOYU OLU??TUR   BEGIN     INSERT INTO @MAD     (ISYERINO,      KASAKODU,      KASAADI     )            SELECT DISTINCT                   KSL.BRANCH,                   LK.CODE,                   LK.NAME            FROM LG_' + @SIRKETNO + '_01_KSLINES AS KSL WITH (NOLOCK)                 JOIN L_CAPIUSER AS U WITH (NOLOCK) ON U.NR LIKE KSL.CAPIBLOCK_CREATEDBY                 JOIN LG_' + @SIRKETNO + '_KSCARD AS LK ON LK.LOGICALREF = KSL.CARDREF            WHERE KSL.SIGN = 1                  AND KSL.AMOUNT >= 300                  AND CONVERT(VARCHAR(10), KSL.DATE_, 104) = CONVERT(VARCHAR(10), GETDATE() - @KACGUNONCE, 104); END; --DEï¿½?I??KEN TABLOYA VERILERI INSERT ET    BEGIN     --D??NG?? I??IN DEï¿½?I??KEN ATAMALARI     DECLARE @S INT= 1, @D INT=     (         SELECT COUNT(LOGICALREF)         FROM @MAD     );      --D??NG??     WHILE @D >= @S         BEGIN              /**** D??NG?? BA??LANGI?? ****/                BEGIN                 SELECT @KASABAKIYE =                 (                     SELECT KASAKODU                     FROM @MAD                     WHERE LOGICALREF = @S                 )+'' KODLU KASANIN G??NCEL BAKIYESI: ''+FORMAT(SUM(CASHTOT.DEBIT - CASHTOT.CREDIT), ''C2'', ''TR-TR'')                 FROM LG_' + @SIRKETNO + '_KSCARD AS CASHC WITH (NOLOCK),                      LG_' + @SIRKETNO + '_01_CSHTOTS AS CASHTOT WITH (NOLOCK)                 WHERE CASHC.CODE LIKE                 (                     SELECT KASAKODU                     FROM @MAD                     WHERE LOGICALREF = @S                 )                       AND CASHTOT.CARDREF = CASHC.LOGICALREF                       AND CASHTOT.TOTTYPE = 1                       AND CASHTOT.DAY_ >= 0                       AND CASHTOT.DAY_ <= 365;             END; --KASA BAKIYESINI DEï¿½?I??KENE ATA                BEGIN                 -- I???? YERINI DEï¿½?I??KENE ATA                 SELECT @ISYERINO = ISYERINO                 FROM @MAD                 WHERE LOGICALREF = @S;             END; -- I???? YERINI DEï¿½?I??KENE ATA;                BEGIN --KASA HAREKETLERINI HTML FORMATINDA XMLE D??N????T??R                       SET @XML = CAST(                                (                                    SELECT F.DATE_ AS ''TD'',                                           '''',                                           F.FICHENO AS ''TD'',                                           '''',                                           F.TRCODE AS ''TD'',                                           '''',                                           F.CUSTTITLE AS ''TD'',                                           '''',                                           F.LINEEXP AS ''TD'',                                           '''',                                           F.AMOUNT AS ''TD'',                                           '''',                                           F.REPORTRATE AS ''TD'',                                           '''',                                           F.REPORTNET AS ''TD'',                                           '''',                                           F.SPECODE AS ''TD'',                                           '''',                                           F.CYPHCODE AS ''TD'',                                           '''',                                           F.BRANCH AS ''TD'',                                           '''',                                           F.NAME AS ''TD'',                                           ''''                                    FROM                                    (                                        SELECT KSL.DATE_,                                               KSL.FICHENO,                                               CASE TRCODE                                                   WHEN 11                                                   THEN ''CARI?? HESAP TAHSI??LAT''                                                   WHEN 12                                                   THEN ''CARI?? I????LEM''                                                   WHEN 21                                                   THEN ''BANKA I????LEMI??''                                                   WHEN 22                                                   THEN ''BANKA I????LEMI??''                                                   WHEN 31                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 32                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 33                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 34                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 35                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 36                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 37                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 38                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 39                                                   THEN ''FATURA I????LEMI??''                                                   WHEN 61                                                   THEN ''??EK-SENET I????LEMI??''                                                   WHEN 62                                                   THEN ''??EK-SENET I????LEMI??''                                                   WHEN 63                                                   THEN ''??EK-SENET I????LEMI??''                                                   WHEN 64                                                   THEN ''??EK-SENET I????LEMI??''                                                   WHEN 71                                                   THEN ''KASA I????LEMI??''                                                   WHEN 72                                                   THEN ''KASA I????LEMI??''                                                   WHEN 73                                                   THEN ''KASA I????LEMI??''                                                   WHEN 74                                                   THEN ''KASA I????LEMI??''                                                   ELSE ''TANIMSIZ I????LEM''                                               END AS ''TRCODE'',                                               KSL.CUSTTITLE,                                               KSL.LINEEXP,                                               FORMAT(AMOUNT, ''C2'', ''TR-TR'') AS ''AMOUNT'',                                               CAST(REPORTRATE AS MONEY) AS ''REPORTRATE'',                                               CAST(REPORTNET AS MONEY) AS ''REPORTNET'',                                               KSL.SPECODE,                                               KSL.CYPHCODE,                                               KSL.BRANCH,                                               U.NAME                                        FROM LG_' + @SIRKETNO + '_01_KSLINES AS KSL WITH (NOLOCK) /**************************************/                                             JOIN L_CAPIUSER AS U WITH (NOLOCK) ON U.NR LIKE KSL.CAPIBLOCK_CREATEDBY                                             JOIN LG_427_KSCARD AS LK ON LK.LOGICALREF = KSL.CARDREF                                        WHERE KSL.SIGN = 1                                              AND KSL.AMOUNT >= 300                                              AND CONVERT(VARCHAR(10), KSL.DATE_, 104) = CONVERT(VARCHAR(10), GETDATE() - @KACGUNONCE, 104)                                              AND KSL.BRANCH =                                        (                                            SELECT ISYERINO                                            FROM @MAD                                            WHERE LOGICALREF = @S                                        )                                              AND LK.CODE =                                        (                                            SELECT KASAKODU                                            FROM @MAD                                            WHERE LOGICALREF = @S                                        )                                    ) AS F                                    FOR XML PATH(''TR''), ELEMENTS                                ) AS NVARCHAR(MAX));             END; --KASA HAREKETLERINI HTML FORMATINDA XML''E D??N????T??R                  BEGIN                 UPDATE @MAD                   SET                       [ALICIADRESLER] = ISNULL(                                               (                                                   SELECT TOP 1 REPLACE(                                                                       (                                                                           SELECT RTRIM(MAIL) [DATA()]                                                                           FROM MAD.DBO.KULLANICILAR K                                                                           WHERE K.SIRKET = ''427''                                                                                 AND IS_YERI = @ISYERINO                                                                                 AND LEN(MAIL) > 0                                                                                 AND DEPERTMAN IN(''' + @ALICIADRESLERINDEPARTMANI + ''')                                                                           FOR XML PATH('''')                                                                       ), '' '', ''; '') AS BIRLESIK                                               ), ''''),                       [BILGIALICIADRESLER] = ISNULL(                                                    (                                                        SELECT TOP 1 REPLACE(                                                                            (                                                                                SELECT RTRIM(MAIL) [DATA()]                                                                                FROM MAD.DBO.KULLANICILAR K                                                                                WHERE K.SIRKET = ''427''                                                                                      AND IS_YERI = @ISYERINO                                                                                      AND LEN(MAIL) > 0                                                                                      AND DEPERTMAN IN(''' + @BILGIALICIADRESLERINDEPARTMANI + ''')                                                                                FOR XML PATH('''')                                                                            ), '' '', ''; '') AS BIRLESIK                                                    ), ''''),                       [GIZLIBILGIALICIADRESLER] = ISNULL(                                                         (                                                             SELECT TOP 1 REPLACE(                                                                                 (                                                                                     SELECT RTRIM(MAIL) [DATA()]                                                                                     FROM MAD.DBO.KULLANICILAR K                                                                                     WHERE K.SIRKET = ''427''                                                                                           AND LEN(MAIL) > 0                                                                                           AND DEPERTMAN IN(''' + @GIZLIALICIADRESLERINDEPARTMANI + ''')                                                                                     FOR XML PATH('''')                                                                                 ), '' '', ''; '') AS BIRLESIK                                                         ), '''')                 WHERE ISYERINO = @ISYERINO;             END; -- DEï¿½?I??KEN TABLOYA MAIL ADRESLERINI UPDATE ET                BEGIN                 UPDATE @MAD                   SET                       [ALICIADRESLER] = [BILGIALICIADRESLER]                 WHERE [ALICIADRESLER] = '''';             END; -- DEï¿½?I??KEN TABLODA ALICI ADRESI BO?? OLANLARA BILGIDEKI ADRESLERI ALICI OLARAK EKLE                BEGIN                 SET @BASLIK = '''';                 SET @MESAJ = '''';                 SET @VUCUT = '''';                 SELECT @BASLIK+=CONVERT( NVARCHAR, @ISYERINO)+'' NOLU I??YERININ KASA HAREKETLERIDIR. [212]'';                 SELECT @MESAJ+='''';                 SET @VUCUT = ''<HTML>''+''<BODY>''+''<H3 STYLE = "COLOR:BLUE;"><I>''+@MESAJ+''</I> </H3>''+''<H2 STYLE="TEXT-ALIGN:CENTER; COLOR:ORANGE;"> KASA HAREKETLERI </H2>''+''<H4> ''+''<UL STYLE = "LIST-STYLE-TYPE:DISC">''+''<P>''+''<LI>''+@KASABAKIYE+''</LI>''+''</UL>''+''</P>''+''<H4> ''+''                     <TABLE BORDER = 1>                      <TR>                     <TH> TARIH </TH> <TH> FI?? NO </TH> <TH> I????LEM T??R?? </TH> <TH> CARI BA??LIï¿½?I </TH> <TH> A??IKLAMA </TH> <TH> TUTAR </TH> <TH> KUR </TH> <TH> D??VIZ TUTAR </TH> <TH> ??ZEL KODU </TH> <TH> YETKI KODU </TH> <TH> I???? YERI </TH> <TH> KAYDEDEN KULLANICI </TH>                     </TR>'';                 SET @VUCUT = @VUCUT+@XML+''</TABLE></BODY></HTML>''+''[''+CONVERT(NVARCHAR, @ISYERINO)+'' NOLU I??YERININ ''+                 (                     SELECT KASAKODU                     FROM @MAD                     WHERE LOGICALREF = @S                 )+'' KODLU KASANIN ''+CONVERT(NVARCHAR, @KACGUNONCE)+'' G??N ??NCESINE AIT HAREKETLERIDIR.] BU MAILE CEVAP VEREREK BILGILENDIRME MAILI ILE ALAKALI TAVSIYENIZI YAZABILIRSINIZ.'';             END; --MAIL VERILERINI HAZIRLA                BEGIN                 SET @ALICIADRESLER =                 (                     SELECT M.[ALICIADRESLER]                     FROM @MAD M                     WHERE M.LOGICALREF = @S                 );                 SET @BILGIALICIADRESLER =                 (                     SELECT M.[BILGIALICIADRESLER]                     FROM @MAD M                     WHERE M.LOGICALREF = @S                 );                 SET @GIZLIBILGIALICIADRESLER =                 (                     SELECT M.[GIZLIBILGIALICIADRESLER]                     FROM @MAD M                     WHERE M.LOGICALREF = @S                 );             END; -- MAIL ADRESLERINI DEï¿½?I??KENLERE TANIMLA                BEGIN                 EXEC MSDB.DBO.SP_SEND_DBMAIL                      @BODY = @VUCUT,                      @BODY_FORMAT = ''HTML'',                      @SUBJECT = @BASLIK,                      @IMPORTANCE = ''HIGH'',                      @REPLY_TO = ''MUSTAFAALPEREN@FIMAR.COM.TR'',                      @PROFILE_NAME = ''MAD_MAIL'',                      --@RECIPIENTS = @ALICIADRESLER,                      --@COPY_RECIPIENTS = @BILGIALICIADRESLER,                      @BLIND_COPY_RECIPIENTS = @GIZLIBILGIALICIADRESLER,                      @EXECUTE_QUERY_DATABASE = ''FIMAR_MHB'';             END; --MAIL G??NDER                BEGIN                 DECLARE @GONDERILENMAILBILGISI NVARCHAR(MAX)= ''MAIL (ID: ''+CONVERT(NVARCHAR, @@IDENTITY)+'') QUEUED.'';                 EXEC SP_MAD_LOGLAR_INS                      @FORM = ''AGENT_MAD_08_00_MAILLERI'',                      @KULLANICI = ''SQL AGENT'',                      @TERMINAL = ''427'',                      @ASISTAN = @GONDERILENMAILBILGISI,                      @DERECE = ''BAL'';             END; --LOGLAMA YAP                BEGIN                 SET @S = @S + 1;             END; --D??NG?? I??IN D??NG?? DEï¿½?I??KENINI +1 ARTTIR                             /**** D??NG?? BI??TI???? ****/          END; END; -- MAIL G??NDERME D??NG??S?? ';
EXECUTE SP_EXECUTESQL @SQLQUERY;


prumerny:

SELECT S.PRODUCT_ID, S.LINK, C.ID AS CATEGORY_ID, C.NAME AS CATEGORY_NAME FROM PRODUCTS P INNER JOIN SEO S ON S.PRODUCT_ID = P.ID  OUTER APPLY (   SELECT TOP 1 *    FROM CATEGORIES CAT   WHERE CAT.PRODUCT_ID = P.ID   ORDER BY CAT.ID ) C WHERE P.ACTIVE = 1 AND P.PRODUCT_TYPE = 1;


nejrychlejsi:

SELECT "SHORT_COL_HERE" FROM "ENGAGEMENTS"@MYDATABASELINK